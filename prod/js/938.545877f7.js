"use strict";(self["webpackChunkvue_strategy_front_backend"]=self["webpackChunkvue_strategy_front_backend"]||[]).push([[938],{7465:function(e,l,t){t.d(l,{F3:function(){return n},M3:function(){return i},yV:function(){return o}});var a=t(3512);function n(){return(0,a.Z)({url:"/role/list",method:"get"})}function o(e){return(0,a.Z)({url:`/role/permission/${e}`,method:"get"})}function i(e){return(0,a.Z)({url:"/role/distribute-permission",method:"post",data:e})}},4401:function(e,l,t){t.d(l,{a:function(){return a},b:function(){return n}});const a=[5,10,20,50,100],n="total, sizes, prev, pager, next"},2938:function(e,l,t){t.r(l),t.d(l,{default:function(){return P}});var a=t(3396),n=t(7139);const o={class:"user-manage-container"},i={class:"excel-btn"},r={class:"center"},u={key:0},s={key:1},c={class:"pagination-container"};function d(e,l,t,d,p,m){const g=(0,a.up)("el-button"),f=(0,a.up)("el-card"),w=(0,a.up)("el-table-column"),v=(0,a.up)("el-avatar"),k=(0,a.up)("el-tag"),C=(0,a.up)("el-table"),b=(0,a.up)("el-pagination"),y=(0,a.up)("role-dialog"),x=(0,a.Q2)("permission"),h=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(f,{class:"header"},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a.wy)(((0,a.wg)(),(0,a.j4)(g,{type:"primary",onClick:d.onImportExcelClick},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("excel.importExcel")),1)])),_:1},8,["onClick"])),[[x,"importUser"]]),(0,a.Wm)(g,{type:"success",onClick:d.onExportExcelClick},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("excel.exportExcel")),1)])),_:1},8,["onClick"])])])),_:1}),(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.j4)(C,{data:d.tableManageData.list,border:"",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{label:"#",type:"index"}),(0,a.Wm)(w,{label:e.$t("excel.name"),prop:"username"},null,8,["label"]),(0,a.Wm)(w,{label:e.$t("excel.mobile"),prop:"mobile"},null,8,["label"]),(0,a.Wm)(w,{label:e.$t("excel.avatar"),width:"120"},{default:(0,a.w5)((({row:e})=>[(0,a._)("div",r,[(0,a.Wm)(v,{src:e.avatar,class:"avatar",shape:"circle"},null,8,["src"])])])),_:1},8,["label"]),(0,a.Wm)(w,{label:e.$t("excel.role")},{default:(0,a.w5)((({row:l})=>[l.role&&l.role.length?((0,a.wg)(),(0,a.iD)("div",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.role,(e=>((0,a.wg)(),(0,a.j4)(k,{key:e.id,size:"small"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.title),1)])),_:2},1024)))),128))])):((0,a.wg)(),(0,a.iD)("div",s,[(0,a.Wm)(k,{size:"small"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("excel.defaultRole")),1)])),_:1})]))])),_:1},8,["label"]),(0,a.Wm)(w,{label:e.$t("excel.openTime"),prop:"openTime"},{default:(0,a.w5)((({row:l})=>[(0,a.Uk)((0,n.zw)(e.dayjs(l.openTime).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1},8,["label"]),(0,a.Wm)(w,{label:e.$t("excel.action"),fixed:"right",width:"240"},{default:(0,a.w5)((({row:l})=>[(0,a.Wm)(g,{type:"primary",size:"small",onClick:e=>d.onDetailBtnClick(l)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("excel.show")),1)])),_:2},1032,["onClick"]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(g,{type:"info",size:"small",onClick:e=>d.onShowRoleBtnClick(l)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("excel.showRole")),1)])),_:2},1032,["onClick"])),[[x,"distributeRole"]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(g,{onClick:e=>d.onUserRemoveBtnClick(l),type:"danger",size:"small"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("excel.remove")),1)])),_:2},1032,["onClick"])),[[x,"removeUser"]])])),_:1},8,["label"])])),_:1},8,["data"])),[[h,d.loading]]),(0,a._)("div",c,[(0,a.Wm)(b,{background:"",class:"pagination",onCurrentChange:d.onCurrentPageChange,onSizeChange:d.onPageSizeChange,"current-page":d.requestParameter.page,"page-size":d.requestParameter.size,"page-sizes":d.pageSizes,total:d.tableManageData.total,layout:d.layout},null,8,["onCurrentChange","onSizeChange","current-page","page-size","page-sizes","total","layout"])])])),_:1}),(0,a.Wm)(y,{modelValue:d.roleDialogVisible,"onUpdate:modelValue":l[0]||(l[0]=e=>d.roleDialogVisible=e),userId:d.selectUserId,onUpdateRole:d.onRoleUpdated,onClose:d.onDialogClose},null,8,["modelValue","userId","onUpdateRole","onClose"])])}var p=t(4401),m=t(7541),g=t(4870),f=t(8676),w=t(678),v=t(5499),k=t(327),C=t(2807),b=t(4329),y=t(3126),x=t(6554),h=t.n(x),_=t(7092);function z(e,l){return e.map((e=>Object.keys(y.m).map((t=>{const a=y.m[t];return"function"===typeof l?l(a,e[a]):e[a]}))))}function D(e,l){let t=_.P6.aoa_to_sheet([Object.keys(y.m)]);t=_.P6.sheet_add_json(t,l,{skipHeader:!0,origin:"A2"});const a=_.P6.book_new();_.P6.book_append_sheet(a,t);const n=h().extname(e).length>0;(0,_.NC)(a,n?e:`${e}.xls`)}var U=t(5743),V=t.n(U);const W={class:"dialog-footer"};function $(e,l,t,o,i,r){const u=(0,a.up)("el-checkbox"),s=(0,a.up)("el-checkbox-group"),c=(0,a.up)("el-button"),d=(0,a.up)("el-dialog");return(0,a.wg)(),(0,a.j4)(d,{title:e.$t("excel.roleDialogTitle"),"model-value":t.modelValue,"append-to-body":"",onClose:o.onDialogClose,onOpen:o.onDialogOpen},{footer:(0,a.w5)((()=>[(0,a._)("span",W,[(0,a.Wm)(c,{onClick:l[1]||(l[1]=l=>e.$emit("update:modelValue",!1))},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("universal.cancel")),1)])),_:1}),(0,a.Wm)(c,{type:"primary",loading:o.updating,onClick:o.onDialogConfirm},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.$t("universal.confirm")),1)])),_:1},8,["loading","onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(s,{modelValue:o.currentUserRoles,"onUpdate:modelValue":l[0]||(l[0]=e=>o.currentUserRoles=e)},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.roles,(e=>((0,a.wg)(),(0,a.j4)(u,{key:e.id,label:e.id},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.title),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["title","model-value","onClose","onOpen"])}var H=t(7465),R={props:{modelValue:{type:Boolean,required:!0},userId:{type:String,required:!0}},emits:["update:modelValue","update-role","close"],setup(e,{emit:l}){const t=(0,g.iH)({role:[],_id:""}),a=(0,b.QT)(),n=(0,g.iH)([]),o=(0,g.iH)([]),i=(0,g.iH)(!1);function r(){l("close")}async function u(){try{i.value=!0;const t=o.value.filter((e=>n.value.findIndex((l=>e.id===l))>-1));await(0,m.hB)(e.userId,t),C.z8.success(a.t("role.updateRoleSuccess")),l("update-role",t),l("update:modelValue",!1)}finally{i.value=!1}}async function s(){const e=await(0,H.F3)();o.value=e}async function c(){const l=e.userId,a=await(0,m.Jm)(l);n.value=a.role.map((e=>e.id)),t.value=a}function d(){c()}return s(),(0,f.B)((()=>{s()})),{onDialogClose:r,onDialogConfirm:u,onDialogOpen:d,userRoles:t,roles:o,updating:i,currentUserRoles:n}}},T=t(89);const B=(0,T.Z)(R,[["render",$]]);var I=B,S={name:"user-manage",components:{RoleDialog:I},setup(){const e=(0,w.tv)(),l=(0,b.QT)(),t=(0,g.iH)(!1),n=(0,g.iH)(""),o=(0,g.iH)(!1),i=(0,g.iH)({size:5,page:1}),r=(0,g.iH)({list:[],page:i.value.page,size:i.value.size,total:0});async function u(){t.value=!0;try{const e=await(0,m.Hf)(i.value);r.value=e}catch{r.value.list=[],r.value.total=0}finally{t.value=!1}}function s(e){i.value.size=e,i.value.page=1,u()}function c(e){i.value.page=e,u()}function d(){e.push({name:"import"})}async function y(e){const t=l.t("excel.dialogTitle1")+e.username+l.t("excel.dialogTitle2");await v.T.confirm(t,l.t("excel.dialogTitle0"),{type:"warning"}),await(0,m.h8)(e._id),(0,k.bM)({title:l.t("excel.removeSuccessTitle"),message:l.t("excel.removeSuccess"),type:"success"}),u()}function x(){v.T.prompt(l.t("excel.genExcelTitle"),{showCancelButton:!0,showInput:!0,inputPlaceholder:l.t("excel.placeholder"),inputValidator(e){return e.length>0},inputErrorMessage:l.t("excel.errorExcelName"),inputValue:l.t("excel.defaultName"),beforeClose:async(e,t,a)=>{if("confirm"===e){if(!t.inputValidator(t.inputValue))return;t.confirmButtonLoading=!0,t.confirmButtonText=l.t("excel.genExceling");try{await h(t.inputValue)}catch(n){C.z8.error(n.message)}finally{a()}}else a()}}).then((e=>{console.log(e)}))}async function h(e){const{list:l}=await(0,m.Ot)(),t=z(l,((e,l)=>{if("role"===e){const e=l;return e.map((e=>e.title)).toString()}return"openTime"===e?V()(Number.isNaN(+l)?l:+l).format("YYYY-MM-DD HH:mm:ss"):l}));D(e,t)}function _(l){e.push({name:"userInfo",params:{id:l._id}})}function U(e){o.value=!0,n.value=e._id}function W(e){const l=n.value,t=r.value.list.find((e=>e._id===l));t&&(t.role=e.map((e=>({id:e.id,title:e.title}))))}function $(){n.value=""}return(0,f.B)((()=>{u()}),{immediate:!0}),(0,a.dl)((()=>{u()})),{tableManageData:r,requestParameter:i,loading:t,onPageSizeChange:s,onCurrentPageChange:c,pageSizes:p.a,onImportExcelClick:d,onUserRemoveBtnClick:y,onExportExcelClick:x,onDetailBtnClick:_,onShowRoleBtnClick:U,onRoleUpdated:W,onDialogClose:$,roleDialogVisible:o,selectUserId:n,layout:p.b}}};const E=(0,T.Z)(S,[["render",d],["__scopeId","data-v-788511a1"]]);var P=E}}]);
//# sourceMappingURL=938.545877f7.js.map